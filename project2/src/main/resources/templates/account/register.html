<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<title>Edgecut - Bank Accounts</title>
<link rel="icon" href="/images/fevicon.png" type="image/gif" />
<link th:href="@{/css/bootstrap.css}" rel="stylesheet" />
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
	rel="stylesheet" />
<link rel="stylesheet" type="text/css"
	th:href="@{/css/font-awesome.min.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/responsive.css}" />
<link rel="stylesheet" th:href="@{/css/account/register.css}" />
</head>
<body>
	<div class="wrapper">
		<!-- 헤더 섹션 -->
		<header class="header_section long_section px-0">
			<nav class="navbar navbar-expand-lg custom_nav-container ">
				<a class="navbar-brand" href="/index.html"> <span> Edgecut
				</span>
				</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse"
					data-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent" aria-expanded="false"
					aria-label="Toggle navigation">
					<span class=""> </span>
				</button>

				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<div
						class="d-flex mx-auto flex-column flex-lg-row align-items-center">
						<ul class="navbar-nav  ">
							<li class="nav-item "><a class="nav-link" href="/index.html">Home<span
									class="sr-only">(current)</span></a></li>
							<li class="nav-item"><a href="/market/access"
								class="nav-link">Region Market</a></li>
							<li class="nav-item active"><a class="nav-link"
								href="/shop/list">Shopping Mall</a></li>
							<li class="nav-item"><a class="nav-link"
								href="/account/list">Account</a></li>
						</ul>
					</div>
					<div class="quote_btn-container">
						<span style="color: black; margin-right: 15px;"> <i
							class="fa fa-user" aria-hidden="true"></i> <span
							sec:authentication="name"></span>
						</span>
						<div class="d-flex flex-column">
							<a th:href="@{/logout}" class="btn btn-outline-info mb-2"
								style="color: #6bb7be; border-color: #6bb7be;"> <i
								class="fa fa-sign-out" aria-hidden="true"></i> <span>Logout</span>
							</a>
						</div>
					</div>
				</div>
			</nav>
		</header>

		<!-- 메인 컨텐츠 -->
		<div class="content-container">
			<div class="form-container">
				<h2 class="form-title">Create New Account</h2>
				<div th:if="${error}" class="alert alert-danger" role="alert">
					<span th:text="${error}"></span>
				</div>
				<form action="/account/register" method="post" id="accountForm">
					<input type="hidden" name="memberId"
						th:value="${#authentication.principal.username}">

					<div class="form-group">
						<label for="accountId" class="form-label">Account Number</label> <input
							type="text" id="accountId" name="accountId" class="form-control"
							required pattern="\d{8,14}" placeholder="8~14자리 숫자를 입력하세요.">
						<div class="valid-feedback feedback-message">생성 가능한 계좌번호입니다.
						</div>
						<div class="invalid-feedback feedback-message">이미 생성된 계좌입니다.
						</div>
					</div>

					<div class="form-group">
						<label for="balance" class="form-label">Initial Deposit
							Amount</label> <input type="number" id="balance" name="balance"
							class="form-control" required min="0"
							placeholder="Enter initial amount">
					</div>

					<div class="form-group">
						<button type="submit" class="btn-primary">Create Account</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script th:inline="javascript">
        document.getElementById('accountId').addEventListener('change', async function() {
            const accountId = this.value;
            if (!accountId) {
                this.classList.remove('is-valid', 'is-invalid');
                return;
            }

            try {
                const response = await fetch(`/account/checkAccountId?accountId=${accountId}`);
                const data = await response.json();
                
                if (data.isDuplicate) {
                    this.classList.add('is-invalid');
                    this.classList.remove('is-valid');
                    this.setCustomValidity('이미 존재하는 계좌번호입니다.');
                } else {
                    this.classList.add('is-valid');
                    this.classList.remove('is-invalid');
                    this.setCustomValidity('');
                }
            } catch (error) {
                console.error('계좌번호 중복 확인 중 오류가 발생했습니다:', error);
            }
        });
    </script>
</body>
</html>